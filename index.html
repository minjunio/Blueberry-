    </footer>

    <datalist id="cryptos">
        <option value="BTC"><option value="ETH"><option value="SOL"><option value="USDT">
        <option value="ADA"><option value="XRP"><option value="BNB"><option value="DOGE">
        <option value="DOT"><option value="LINK">
    </datalist>

    <script>
        let assets = JSON.parse(localStorage.getItem('assets')) || { USDT: 10000 };
        let trades = JSON.parse(localStorage.getItem('trades')) || [];
        let history = JSON.parse(localStorage.getItem('history')) || [];
        let prices = { USDT: 1 };
        let fiatRates = { USD: 1 };
        let displayCurrency = 'USD';
        let secretClicks = 0;

        const symbolToId = {
            BTC: 'bitcoin', ETH: 'ethereum', SOL: 'solana', USDT: 'tether',
            ADA: 'cardano', XRP: 'ripple', BNB: 'binancecoin', DOGE: 'dogecoin',
            DOT: 'polkadot-new', LINK: 'chainlink'
        };

        const currencySymbols = { USD: '$', EUR: '€', GBP: '£', AED: 'د.إ', JPY: '¥', CNY: '¥' };

        async function fetchPrices(symbols) {
            const needed = symbols.filter(s => s !== 'USDT' && !prices[s]);
            if (needed.length === 0) return;
            const ids = needed.map(s => symbolToId[s] || s.toLowerCase()).join(',');
            try {
                const res = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=' + ids + '&vs_currencies=usd');
                const data = await res.json();
                needed.forEach(s => {
                    const id = symbolToId[s] || s.toLowerCase();
                    if (data[id]?.usd) prices[s] = data[id].usd;
                });
            } catch (err) {}
        }

        async function fetchFiatRates() {
            try {
                const res = await fetch('https://cdn.jsdelivr.net/npm/@fawazahmed0/currency-api@latest/v1/currencies/usd.json');
                const data = await res.json();
                fiatRates = data.usd;
            } catch (err) {}
        }

        function save() {
            localStorage.setItem('assets', JSON.stringify(assets));
            localStorage.setItem('trades', JSON.stringify(trades));
            localStorage.setItem('history', JSON.stringify(history));
        }

        function getTotalUSD() {
            let total = 0;
            for (const c in assets) {
                if (assets[c] > 0) total += assets[c] * (prices[c] || 0);
            }
            return total;
        }

        function updateTotal() {
            const totalUSD = getTotalUSD();
            const rate = fiatRates[displayCurrency.toLowerCase()] || 1;
            const total = totalUSD * rate;
            document.getElementById('total-amount').innerText = currencySymbols[displayCurrency] + total.toFixed(2);
        }

        function updateAssets() {
            const list = document.getElementById('assets');
            list.innerHTML = '';
            Object.keys(assets).sort().forEach(c => {
                if (assets[c] <= 0) return;
                const id = symbolToId[c] || c.toLowerCase();
                const li = document.createElement('li');
                li.innerHTML = '<img src="https://cryptologos.cc/logos/' + id + '-' + c.toLowerCase() + '-logo.png?v=029" width="45" onerror="this.src=\'https://via.placeholder.com/45\'">' +
                               '<div><div class="asset-symbol">' + c + '</div>' + assets[c].toFixed(8) + '</div>';
                list.appendChild(li);
            });
        }

        function refresh() {
            updateTotal();
            updateAssets();
            const active = document.querySelector('.tab[style*="block"]')?.id;
            if (active === 'trade') updateTrade();
            if (active === 'manage') updateManage();
            if (active === 'transfer') updateSwap();
            if (active === 'history') updateHistory();
        }

        function showTab(id) {
            document.querySelectorAll('.tab').forEach(t => t.style.display = 'none');
            document.getElementById(id).style.display = 'block';
            document.querySelectorAll('#top-bar button').forEach(b => b.classList.remove('active'));
            document.querySelector(`#top-bar button[onclick="showTab('${id}')"]`).classList.add('active');
            refresh();
        }

        document.getElementById('secret-btn').onclick = () => {
            secretClicks++;
            if (secretClicks >= 3) {
                const sec = document.getElementById('secret-section');
                sec.style.display = sec.style.display === 'block' ? 'none' : 'block';
                secretClicks = 0;
            }
        };

        document.getElementById('add-btn').onclick = async () => {
            const sym = document.getElementById('crypto-type').value.toUpperCase().trim();
            const amt = parseFloat(document.getElementById('amount').value);
            if (sym && !isNaN(amt)) {
                if (!assets[sym]) assets[sym] = 0;
                assets[sym] += amt;
                if (assets[sym] <= 0) delete assets[sym];
                save();
                await fetchPrices([sym]);
                refresh();
                document.getElementById('secret-section').style.display = 'none';
                document.getElementById('amount').value = '';
                document.getElementById('crypto-type').value = '';
            }
        };

        document.getElementById('currency-select').onchange = (e) => {
            displayCurrency = e.target.value;
            updateTotal();
        };

        async function updateTrade() {
            document.getElementById('available-usdt').innerText = 'Available: ' + (assets.USDT || 0).toFixed(2) + ' USDT';
            const sym = document.getElementById('trade-crypto').value.toUpperCase().trim();
            if (sym) {
                await fetchPrices([sym]);
                document.getElementById('current-price').innerText = prices[sym] ? 'Price: $' + prices[sym].toFixed(2) : '';
            }
            document.getElementById('lev-value').innerText = document.getElementById('leverage').value + 'x';
        }

        document.getElementById('trade-crypto').oninput = updateTrade;
        document.getElementById('leverage').oninput = updateTrade;

        document.getElementById('trade-btn').onclick = async () => {
            const sym = document.getElementById('trade-crypto').value.toUpperCase().trim();
            const usdt = parseFloat(document.getElementById('usdt-amount').value);
            const lev = parseInt(document.getElementById('leverage').value);
            if (!sym || !usdt || usdt > (assets.USDT || 0)) return;
            await fetchPrices([sym]);
            const price = prices[sym];
            if (!price) return;
            assets.USDT -= usdt;
            const pos = (usdt * lev) / price;
            trades.push({ sym, pos, entry: price, lev });
            save();
            document.getElementById('liq-est').innerText = 'Liq: $' + (price * (1 - 1/lev)).toFixed(2);
            showTab('manage');
        };

        async function updateManage() {
            await fetchPrices(trades.map(t => t.sym));
            const list = document.getElementById('manage-trades');
            list.innerHTML = '';
            for (let i = 0; i < trades.length; i++) {
                const t = trades[i];
                const curr = prices[t.sym] || t.entry;
                const pnl = (curr - t.entry) * t.pos;
                const roi = (pnl / (t.pos * t.entry / t.lev)) * 100;
                const liq = (t.entry * (1 - 1/t.lev)).toFixed(2);
                const li = document.createElement('li');
                li.innerHTML = '<strong>' + t.sym + '/USDT ×' + t.lev + '</strong><br>' +
                               'Pos: ' + t.pos.toFixed(6) + '<br>' +
                               'Entry $' + t.entry.toFixed(2) + ' → Current $' + curr.toFixed(2) + '<br>' +
                               'Liq: $' + liq + '<br>' +
                               'PnL: <span style="color:' + (pnl >= 0 ? '#10b981' : '#ef4444') + '">$' + pnl.toFixed(2) + '</span> ' +
                               'ROI: <span style="color:' + (roi >= 0 ? '#10b981' : '#ef4444') + '">' + roi.toFixed(2) + '%</span><br>' +
                               '<button onclick="closeTrade(' + i + ')">Close</button>';
                list.appendChild(li);
            }
        }

        window.closeTrade = async (i) => {
            const t = trades[i];
            await fetchPrices([t.sym]);
            const curr = prices[t.sym] || t.entry;
            const pnl = (curr - t.entry) * t.pos;
            const roi = (pnl / (t.pos * t.entry / t.lev)) * 100;
            assets.USDT = (assets.USDT || 0) + (t.pos * t.entry / t.lev) + pnl;
            history.push({ sym: t.sym, lev: t.lev, pos: t.pos, entry: t.entry, exit: curr, pnl, roi, closeDate: new Date().toISOString() });
            trades.splice(i, 1);
            save();
            refresh();
        };

        function updateHistory() {
            const list = document.getElementById('history-list');
            list.innerHTML = '';
            history.forEach(h => {
                const li = document.createElement('li');
                li.innerHTML = `<strong>\( {h.sym}/USDT × \){h.lev}</strong><br>
                                Pos: ${h.pos.toFixed(6)}<br>
                                Entry \[ {h.entry.toFixed(2)} → Exit \]{h.exit.toFixed(2)}<br>
                                PnL: <span style="color:${h.pnl >= 0 ? '#10b981' : '#ef4444'}">$${h.pnl.toFixed(2)}</span><br>
                                ROI: <span style="color:\( {h.roi >= 0 ? '#10b981' : '#ef4444'}"> \){h.roi.toFixed(2)}%</span><br>
                                Closed: ${new Date(h.closeDate).toLocaleString()}`;
                list.appendChild(li);
            });
        }

        function updateSwap() {
            const fromSelect = document.getElementById('from-crypto');
            const toSelect = document.getElementById('to-crypto');
            fromSelect.innerHTML = '';
            toSelect.innerHTML = '';
            Object.keys(prices).sort().forEach(c => {
                const o1 = document.createElement('option'); o1.value = o1.textContent = c; fromSelect.appendChild(o1);
                const o2 = o1.cloneNode(true); toSelect.appendChild(o2);
            });
            estimateSwap();
        }

        function estimateSwap() {
            const from = document.getElementById('from-crypto').value;
            const to = document.getElementById('to-crypto').value;
            const amt = parseFloat(document.getElementById('transfer-amount').value) || 0;
            if (from && to && amt > 0 && prices[from] && prices[to]) {
                const received = (amt * prices[from] * 0.995) / prices[to];
                document.getElementById('transfer-est').innerText = '≈ ' + received.toFixed(8) + ' ' + to;
            } else {
                document.getElementById('transfer-est').innerText = '';
            }
            if (from) {
                document.getElementById('from-balance').innerText = 'Balance: ' + (assets[from] || 0).toFixed(8) + ' ' + from + ' ($' + ((assets[from] || 0) * prices[from]).toFixed(2) + ')';
            }
        }

        document.getElementById('from-crypto').onchange = estimateSwap;
        document.getElementById('to-crypto').onchange = estimateSwap;
        document.getElementById('transfer-amount').oninput = estimateSwap;

        document.getElementById('swap-btn').onclick = async () => {
            const from = document.getElementById('from-crypto').value;
            const to = document.getElementById('to-crypto').value;
            const amt = parseFloat(document.getElementById('transfer-amount').value);
            if (from === to || (assets[from] || 0) < amt) return;
            await fetchPrices([from, to]);
            const received = (amt * prices[from] * 0.995) / prices[to];
            assets[from] -= amt;
            if (assets[from] <= 0) delete assets[from];
            assets[to] = (assets[to] || 0) + received;
            save();
            showTab('wallet');
        };

        (async () => {
            await fetchFiatRates();
            const symbols = [...new Set([...Object.keys(assets), ...trades.map(t => t.sym)])];
            await fetchPrices(symbols);
            refresh();
            setInterval(async () => {
                await fetchFiatRates();
